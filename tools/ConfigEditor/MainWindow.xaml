<Window x:Class="ConfigEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ConfigEditor"
        xmlns:views="clr-namespace:ConfigEditor.Views"
        mc:Ignorable="d"
        Title="EQ Log Config Editor" Height="720" Width="1100" MinHeight="600" MinWidth="900"
        Background="{StaticResource WindowBackgroundBrush}">
    <DockPanel Background="{StaticResource WindowBackgroundBrush}">
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_Open..." Click="Open_Click" />
                <Separator />
                <MenuItem Header="_Save" Click="Save_Click" />
                <MenuItem Header="Save _As..." Click="SaveAs_Click" />
                <MenuItem Header="_Validate" Click="Validate_Click" />
                <Separator />
                <MenuItem Header="E_xit" Click="Exit_Click" />
            </MenuItem>
            <MenuItem Header="_Presets">
                <MenuItem Header="Insert preset..." Click="InsertPreset_Click" />
            </MenuItem>
        </Menu>

        <Border Margin="12" Padding="12" Background="{StaticResource SurfaceBrush}" BorderBrush="{StaticResource SurfaceBorderBrush}" BorderThickness="1" CornerRadius="6">
        <TabControl>
            <TabItem Header="General">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Background="{StaticResource SurfaceBrush}">
                    <Grid Margin="4" Background="{StaticResource SurfaceBrush}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" MinWidth="150" MaxWidth="250" />
                            <ColumnDefinition Width="*" MinWidth="300" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Grid.Column="0" Margin="0,10,12,6" Text="Log file path" VerticalAlignment="Center" />
                        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Margin="0,10,0,0">
                            <TextBox x:Name="LogFilePathText" MinWidth="200" Margin="0,0,8,0" TextChanged="General_TextChanged"/>
                            <Button Content="Browse..." Click="BrowseLogFile_Click" VerticalAlignment="Center"/>
                        </StackPanel>

                        <TextBlock Grid.Row="1" Grid.Column="0" Margin="0,6,12,6" Text="Output directory" VerticalAlignment="Center" />
                        <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="0,6,0,0">
                            <TextBox x:Name="OutputDirectoryText" MinWidth="200" Margin="0,0,8,0" TextChanged="General_TextChanged"/>
                            <Button Content="Browse..." Click="BrowseOutputDir_Click" VerticalAlignment="Center" />
                        </StackPanel>

                        <TextBlock Grid.Row="2" Grid.Column="0" Margin="0,6,12,6" Text="Polling interval (ms)" VerticalAlignment="Center" />
                        <TextBox Grid.Row="2" Grid.Column="1" x:Name="PollingIntervalText" MinWidth="80" MaxWidth="120" Margin="0,6,0,0" TextChanged="General_TextChanged"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Margin="0,6,12,6" Text="Parallel processing" VerticalAlignment="Center" />
                        <CheckBox Grid.Row="3" Grid.Column="1" x:Name="ParallelProcessingCheck" Margin="0,6,0,0" Checked="General_CheckChanged" Unchecked="General_CheckChanged" />

                        <TextBlock Grid.Row="4" Grid.Column="0" Margin="0,6,12,6" Text="Debug mode" VerticalAlignment="Center" />
                        <CheckBox Grid.Row="4" Grid.Column="1" x:Name="DebugModeCheck" Margin="0,6,0,0" Checked="General_CheckChanged" Unchecked="General_CheckChanged" />

                        <TextBlock Grid.Row="5" Grid.Column="0" Margin="0,6,12,6" Text="Max queue size (0 = unlimited)" VerticalAlignment="Center" />
                        <TextBox Grid.Row="5" Grid.Column="1" x:Name="MaxQueueSizeText" MinWidth="80" MaxWidth="120" Margin="0,6,0,0" TextChanged="General_TextChanged"/>

                        <TextBlock Grid.Row="6" Grid.Column="0" Margin="0,6,12,6" Text="Process errors" VerticalAlignment="Center" />
                        <CheckBox Grid.Row="6" Grid.Column="1" x:Name="ProcessErrorsCheck" Margin="0,6,0,0" Checked="General_CheckChanged" Unchecked="General_CheckChanged" />

                        <TextBlock Grid.Row="7" Grid.Column="0" Margin="0,6,12,6" Text="Process warnings" VerticalAlignment="Center" />
                        <CheckBox Grid.Row="7" Grid.Column="1" x:Name="ProcessWarningsCheck" Margin="0,6,0,0" Checked="General_CheckChanged" Unchecked="General_CheckChanged" />

                        <TextBlock Grid.Row="8" Grid.Column="0" Margin="0,6,12,6" Text="Process info" VerticalAlignment="Center" />
                        <CheckBox Grid.Row="8" Grid.Column="1" x:Name="ProcessInfoCheck" Margin="0,6,0,0" Checked="General_CheckChanged" Unchecked="General_CheckChanged" />

                        <!-- Email Configuration for SMS Action Type -->
                        <TextBlock Grid.Row="9" Grid.Column="0" Margin="0,20,12,6" Text="Email Configuration (for SMS action type)" FontWeight="Bold" VerticalAlignment="Center" />
                        <TextBlock Grid.Row="9" Grid.Column="1" Margin="0,20,0,6" Text="Configure email settings for sending tell messages" FontStyle="Italic" Foreground="Gray" VerticalAlignment="Center" />

                        <TextBlock Grid.Row="10" Grid.Column="0" Margin="0,6,12,6" Text="SMTP Server" VerticalAlignment="Center" />
                        <TextBox Grid.Row="10" Grid.Column="1" x:Name="EmailSmtpServerText" MinWidth="200" Margin="0,6,0,0" TextChanged="General_TextChanged"/>

                        <TextBlock Grid.Row="11" Grid.Column="0" Margin="0,6,12,6" Text="SMTP Port" VerticalAlignment="Center" />
                        <TextBox Grid.Row="11" Grid.Column="1" x:Name="EmailSmtpPortText" MinWidth="60" MaxWidth="80" Margin="0,6,0,0" TextChanged="General_TextChanged"/>

                        <TextBlock Grid.Row="12" Grid.Column="0" Margin="0,6,12,6" Text="Username" VerticalAlignment="Center" />
                        <TextBox Grid.Row="12" Grid.Column="1" x:Name="EmailUsernameText" MinWidth="200" Margin="0,6,0,0" TextChanged="General_TextChanged"/>

                        <TextBlock Grid.Row="13" Grid.Column="0" Margin="0,6,12,6" Text="Password" VerticalAlignment="Center" />
                        <PasswordBox Grid.Row="13" Grid.Column="1" x:Name="EmailPasswordText" MinWidth="200" Margin="0,6,0,0" PasswordChanged="General_PasswordChanged"/>

                        <TextBlock Grid.Row="14" Grid.Column="0" Margin="0,10,12,6" Text="From Email" VerticalAlignment="Center" />
                        <TextBox Grid.Row="14" Grid.Column="1" x:Name="EmailFromText" MinWidth="200" Margin="0,10,0,0" TextChanged="General_TextChanged"/>

                        <TextBlock Grid.Row="15" Grid.Column="0" Margin="0,10,12,6" Text="To Email" VerticalAlignment="Center" />
                        <TextBox Grid.Row="15" Grid.Column="1" x:Name="EmailToText" MinWidth="200" Margin="0,10,0,0" TextChanged="General_TextChanged"/>

                        <TextBlock Grid.Row="16" Grid.Column="0" Margin="0,10,12,6" Text="Enable SSL" VerticalAlignment="Center" />
                        <CheckBox Grid.Row="16" Grid.Column="1" x:Name="EmailEnableSslCheck" Margin="0,10,0,0" Checked="General_CheckChanged" Unchecked="General_CheckChanged" />

                        <TextBlock Grid.Row="17" Grid.Column="0" Margin="0,10,12,6" Text="Email Poll Interval (seconds)" VerticalAlignment="Center" />
                        <TextBox Grid.Row="17" Grid.Column="1" x:Name="EmailPollIntervalText" MinWidth="80" MaxWidth="120" Margin="0,10,0,0" TextChanged="General_TextChanged"/>

                        <!-- Process Targeting Configuration -->
                        <TextBlock Grid.Row="18" Grid.Column="0" Margin="0,20,12,6" Text="Process Targeting" FontWeight="Bold" VerticalAlignment="Center" />
                        <TextBlock Grid.Row="18" Grid.Column="1" Margin="0,20,0,6" Text="Configure which EQGame.exe processes to target" FontStyle="Italic" Foreground="Gray" VerticalAlignment="Center" />

                        <Grid Grid.Row="19" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,6,0,0">
                            <views:ProcessSelector x:Name="ProcessSelector" SelectionChanged="ProcessSelector_SelectionChanged"/>
                        </Grid>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Rules">
                <DockPanel Background="{StaticResource SurfaceBrush}">
                    <ToolBar DockPanel.Dock="Top">
                        <Button Content="Add" Click="AddRule_Click" />
                        <Button Content="Duplicate" Click="DuplicateRule_Click" />
                        <Button Content="Delete" Click="DeleteRule_Click" />
                        <Separator />
                        <Button Content="Edit Rule..." Click="EditRule_Click" />
                        <Separator />
                        <Button Background="{StaticResource AccentBrush}" Foreground="#0B1220" Content="Edit Steps..." Click="EditSteps_Click" />
                        <Separator />
                    </ToolBar>
                    <DataGrid x:Name="RulesGrid" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="False" Margin="8" SelectionMode="Extended" Background="{StaticResource SurfaceBrush}" MouseDoubleClick="RulesGrid_MouseDoubleClick" CellEditEnding="RulesGrid_CellEditEnding">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="Enabled" Width="60" Binding="{Binding Enabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                <DataGridCheckBoxColumn.ElementStyle>
                                    <Style TargetType="CheckBox">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <EventSetter Event="Checked" Handler="EnabledCheckBox_Changed"/>
                                        <EventSetter Event="Unchecked" Handler="EnabledCheckBox_Changed"/>
                                    </Style>
                                </DataGridCheckBoxColumn.ElementStyle>
                                <DataGridCheckBoxColumn.EditingElementStyle>
                                    <Style TargetType="CheckBox">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <EventSetter Event="Checked" Handler="EnabledCheckBox_Changed"/>
                                        <EventSetter Event="Unchecked" Handler="EnabledCheckBox_Changed"/>
                                    </Style>
                                </DataGridCheckBoxColumn.EditingElementStyle>
                            </DataGridCheckBoxColumn>
                            <DataGridTextColumn Header="Name" Width="200" IsReadOnly="True">
                                <DataGridTextColumn.Binding>
                                    <Binding Path="Name" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay" />
                                </DataGridTextColumn.Binding>
                            </DataGridTextColumn>
                            <DataGridComboBoxColumn Header="Action Type" Width="120" IsReadOnly="True">
                                <DataGridComboBoxColumn.SelectedItemBinding>
                                    <Binding Path="ActionType" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged" />
                                </DataGridComboBoxColumn.SelectedItemBinding>
                                <DataGridComboBoxColumn.ItemsSource>
                                    <x:Array Type="{x:Type sys:String}" xmlns:sys="clr-namespace:System;assembly=mscorlib">
                                        <sys:String>keystroke</sys:String>
                                        <sys:String>command</sys:String>
                                        <sys:String>spell</sys:String>
                                        <sys:String>text</sys:String>
                                    </x:Array>
                                </DataGridComboBoxColumn.ItemsSource>
                            </DataGridComboBoxColumn>
                            <DataGridTextColumn Header="Action Value" Width="200" IsReadOnly="True">
                                <DataGridTextColumn.Binding>
                                    <Binding Path="ActionValue" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay" />
                                </DataGridTextColumn.Binding>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Cooldown (ms)" Width="110" IsReadOnly="True">
                                <DataGridTextColumn.Binding>
                                    <Binding Path="CooldownMs" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay" />
                                </DataGridTextColumn.Binding>
                            </DataGridTextColumn>
                            <DataGridTemplateColumn Header="Steps" Width="70">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border x:Name="Badge" Background="{StaticResource AccentBrush}" CornerRadius="10" Padding="6,2" HorizontalAlignment="Center" ToolTip="Multi-step sequence">
                                            <TextBlock Text="{Binding Actions.Count, TargetNullValue=0}" Foreground="#0B1220" FontWeight="SemiBold"/>
                                        </Border>
                                        <DataTemplate.Triggers>
                                            <DataTrigger Binding="{Binding Actions.Count, TargetNullValue=0}" Value="0">
                                                <Setter TargetName="Badge" Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </DataTemplate.Triggers>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>
        </TabControl>
        </Border>
    </DockPanel>
</Window>


